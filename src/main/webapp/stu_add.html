<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdn.staticfile.org/jquery/1.12.4/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="script.js"></script>
    <script>
        var regexp = /\D/g;
        var PROVINCES = ["北京市","天津市","上海市","重庆市","河北省","山西省","内蒙古自治区","辽宁省","吉林省","黑龙江省","江苏省","浙江省","安徽省","福建省","江西省","山东省","河南省","湖北省","湖南省","广东省","海南省","四川省","贵州省","云南省","陕西省","甘肃省","青海省","广西壮族自治区","宁夏回族自治区","新疆维吾尔自治区","西藏自治区","台湾省","香港特别行政区","澳门特别行政区"];
        $(document).ready(function () {
            checkLogin(function(data) {
                if (data.infoValid){
                    if(!data.userInfo.admin) {
                        $("form")[0].innerHTML="<p>非管理员不得访问本页</p>"
                    }
                    else{
                        var addr_select=$("#addr-select")[0];
                        for(var i=0;i<PROVINCES.length;i++) {
                            addr_select.innerHTML+="<option value='"+PROVINCES[i]+"'>"+PROVINCES[i]+"</option>";
                        }
                        $("form")[0].onsubmit=function (){return submit_();}
                    }
                    return;
                }
                $("form")[0].innerHTML="<p>您尚未登录</p>";
            });
            var ids=["age-text","qq-text","phone-text"];
            for (var i = 0; i < ids.length; i++) {
                $("#" + ids[i]).on("keyup paste blur", function () {
                    $(this).val($(this).val().replace(regexp, ''));
                });
            }
        });
        function submit_() {
            var param="type=0";
            param += "&sname="+$("#name-text").val();
            param += "&gender="+$("#gender-option").val();
            param += "&age="+$("#age-text").val();
            var addr=$("#addr-select").val()+$("#addr-text").val();param += "&address=";
            if (addr.length>0) param+=addr;
            var phone=$("#phone-text").val();param += "&phone=";
            if (phone.length>0) {
                if (phone[0] !== '1'||phone.length !== 11) {
                    $("#status").text("手机号格式错误");
                    return FALSE;
                }
                param+=phone;
            }
            var qq=$("#qq-text").val();param += "&qq=";
            if (qq.length>0) param+=qq;
            // console.log(param);
            $.ajax({url:_root_+"student", type:"post", data:param, processData:false, success:function (d) {
                $("#status").text(d);
            }
            });
            return FALSE;
        }
    </script>
    <link rel="stylesheet" href="style/frames.css">
</head>
<body>
<form>
    <p>学生姓名：<input type="text" id="name-text" maxlength="10" required/></p>
    <p>学生性别：
        <select id="gender-option" class="form-control" style="width: 200px;display: inline" required>
            <option value="男">男</option>
            <option value="女">女</option>
        </select></p>
    <p>学生年龄：<input type="text" maxlength="2" id="age-text" required></p>
    <p>地址：&nbsp;&nbsp;&nbsp;&nbsp;<select id="addr-select" class="form-control" style="width: 180px;display: inline"></select>&nbsp;
        <input type="text" id="addr-text" placeholder="请输入具体地址"></p>
    <p>QQ：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" maxlength="12" id="qq-text"></p>
    <p>手机号：<input type="text" maxlength="11" id="phone-text"></p>
    <input type="submit" value="提交" class="btn btn-primary">
    <p style="color:red;font-size: small;font-weight: bold" id="status"></p>
</form>
</body>
</html>
